# 2. 技术架构总览 (Technical Architecture)

## 2.1 技术栈 (Tech Stack)

### Backend (Core)
- **Language**: Rust (Edition 2021)
- **Framework**: Tauri 2.0 (Beta/RC)
- **Async Runtime**: Tokio
- **Web Server**: Axum (用于 WebSocket 服务)
- **Libraries**:
    - `rosc`: OSC 协议编解码
    - `tokio-tungstenite`: WebSocket 通信
    - `serde`: 数据序列化/反序列化
    - `windows`: Windows API 调用 (用于任务计划程序)

### Frontend (UI)
- **Framework**: Svelte 4
- **Build Tool**: Vite
- **Styling**: TailwindCSS (Utility-first CSS)
- **State Management**: Svelte Stores (`writable`)
- **Icons**: Lucide Svelte
- **I18n**: `svelte-i18n` (支持中英切换)

## 2.2 架构图解 (Architecture Diagram)

```mermaid
graph TD
    subgraph "External World"
        Sender[OSC Sender (TouchDesigner/Live)]
        Receiver[OSC Receiver (VRChat)]
        WebClient[Web Browser]
    end

    subgraph "OSC-Bridge (Tauri App)"
        subgraph "Rust Backend"
            OSC_Listener[UDP Listener (Tokio)]
            OSC_Sender[UDP Sender]
            WS_Server[Axum WebSocket Server]
            Tauri_Cmd[Tauri Commands]
            Config_Mgr[Config Manager]
        end

        subgraph "Svelte Frontend"
            UI_Store[Svelte Stores]
            Settings_UI[Settings Modal]
            Monitor_UI[Traffic Monitor]
        end
    end

    Sender -->|UDP / OSC| OSC_Listener
    OSC_Listener -->|Internal Channel| WS_Server
    OSC_Listener -->|Forward Rule| OSC_Sender
    OSC_Sender -->|UDP / OSC| Receiver
    
    WS_Server <-->|WebSocket| WebClient
    
    UI_Store <-->|Tauri Invoke| Tauri_Cmd
    Tauri_Cmd -->|Read/Write| Config_Mgr
    WS_Server -->|Push Stats| Monitor_UI
```

## 2.3 关键数据流
1.  **配置加载 (Startup)**:
    - Rust 启动 -> 读取 `config.json` -> 初始化 `GlobalState` -> 启动 UDP 监听和 WebSocket 服务 -> 创建 Tauri 窗口。
2.  **OSC 消息处理**:
    - UDP Socket 收到 Bytes -> `rosc` 解码 -> 封装为内部 msg -> 发送给 Broadcast Channel (WebSocket) -> 匹配转发规则 -> 发送给 Target Port。
3.  **UI 交互**:
    - 用户修改设置 (SettingsModal) -> 暂存本地变量 -> 点击保存 -> 调用 Tauri Command `save_config` -> Rust 更新内存配置并写入磁盘 -> 重启相关网络服务 (如端口变动)。

## 2.4 目录结构关键点
- `Source/Tauri/src`: Rust 核心代码
    - `main.rs`: 入口，Tauri 构建器配置
    - `lib.rs`: 核心逻辑库，命令定义
    - `osc.rs` / `server.rs`: 网络服务实现
    - `schtasks.rs`: Windows 任务计划程序封装
- `Source/Svelte`: 前端代码
    - `lib/components`: UI 组件 (SettingsModal, TrafficMonitor)
    - `lib/stores`: 状态管理
    - `lib/bridge`: 与 Rust 通信的桥接层
