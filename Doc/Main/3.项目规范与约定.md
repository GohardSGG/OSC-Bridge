# 3. 项目规范与约定 (Project Standards)

## 3.1 代码风格规范

### Rust
- 遵循标准 `rustfmt` 格式化规则。
- 变量命名：`snake_case` (如 `listening_ports`)。
- 类型/结构体：`PascalCase` (如 `AppConfig`)。
- 错误处理：优先使用 `anyhow::Result` 或自定义 `thiserror` 枚举，避免滥用 `unwrap()`。

### Frontend (Svelte/TS)
- 缩进：4空格 (当前项目约定)。
- 组件命名：`PascalCase.svelte` (如 `SettingsModal.svelte`)。
- 样式：优先使用 **TailwindCSS** 类名，避免在 `<style>` 标签中写过多的自定义 CSS，除非是动画 keyframes。
- 状态管理：Store 变量名应具备语义，如 `isSettingsOpen`。

## 3.2 文件命名约定
- **Rust 模块**：全部小写，下划线连接 (如 `schtasks.rs`).
- **配置文件**：`config.json` (位于运行目录下)。
- **文档**：放置在 `Doc/Main` 下，使用序号前缀以便排序 (如 `1.项目概述.md`).

## 3.3 Commit 提交规范
建议使用 Angular 规范：
- `feat`: 新功能
- `fix`: 修复 Bug
- `docs`: 文档变更
- `style`: 格式调整 (不影响逻辑)
- `refactor`: 重构 (无新功能或 Bug 修复)
- `chore`: 构建过程或辅助工具变动

示例：
> `feat(settings): add real-time preview for UI scale`
> `fix(schtasks): repair xml generation for auto-start task`

## 3.4 核心逻辑约定
1.  **设置隔离 (Settings Isolation)**:
    - 所有“关键配置”（端口、IP）必须在用户点击保存后才生效。
    - UI 组件内部必须维护一份 `local` 状态 (buffer) 用于编辑，不可直接绑定全局 Store。
2.  **错误处理**:
    - 后端 Panic 必须被捕获，不能导致整个 App 崩溃。
    - 前端网络请求失败（如 Save Config）应给出 Toast 提示或红框警告。
3.  **自启动管理**:
    - 必须使用 `schtasks` (Windows Task Scheduler) 而不是注册表 Run Key，以支持更高的权限运行 (HighestAvailable / InteractiveToken)。
